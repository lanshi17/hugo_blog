{{ define "main" }}
<article class="archives-container" style="max-width: 800px; margin: 2rem auto; padding: 0 1rem;">

  <!-- ==================== 统计卡片 ==================== -->
  <div class="stats-card" style="background: #f8f9fa; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
    <div style="display: flex; gap: 1.5rem; justify-content: center; flex-wrap: wrap;">
      {{ $allPosts := where site.RegularPages "Section" "in" (slice "posts" "studynotes" "portfolio") }}
      <div class="stat-item">
        <div class="stat-number">{{ len $allPosts }}</div>
        <div class="stat-label">总文章</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">{{ len site.Taxonomies.categories }}</div>
        <div class="stat-label">分类</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">{{ len site.Taxonomies.tags }}</div>
        <div class="stat-label">标签</div>
      </div>
    </div>
  </div>

  <!-- ==================== 分类/标签云 ==================== -->
  <div class="taxonomy-clouds" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin: 2rem 0;">
    <!-- 分类云 -->
    <div class="category-cloud" style="background: #f8f9fa; border-radius: 8px; padding: 1.5rem;">
      <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 0.5rem; margin-bottom: 1rem;">分类导航</h3>
      <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
        {{ range site.Taxonomies.categories }}
        <a href="{{ .Page.RelPermalink }}" style="
          background: #e8f4ff;
          padding: 0.3rem 0.8rem;
          border-radius: 20px;
          text-decoration: none;
          color: #2c3e50;
          transition: all 0.3s;
          font-size: 0.9rem;
          border: 1px solid #cfe2ff;
        ">
          {{ .Page.Title }} ({{ .Count }})
        </a>
        {{ end }}
      </div>
    </div>

    <!-- 标签云 -->
    <div class="tag-cloud" style="background: #f8f9fa; border-radius: 8px; padding: 1.5rem;">
      <h3 style="color: #2c3e50; border-bottom: 2px solid #34db7f; padding-bottom: 0.5rem; margin-bottom: 1rem;">热门标签</h3>
      <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
        {{ $tags := site.Taxonomies.tags.ByCount }}
        {{ range $tags }}
        {{ $tagURL := printf "/tags/%s/" ( .Term | urlize ) }}
        <a href="{{ $tagURL }}" style="
          background: #e2fbe8;
          padding: 0.3rem 0.8rem;
          border-radius: 20px;
          text-decoration: none;
          color: #2c3e50;
          transition: all 0.3s;
          font-size: 0.9rem;
          border: 1px solid #b8e6c5;
          margin: 0.2rem;
        ">
          {{ .Term }} ({{ .Count }})
        </a>
        {{ end }}
      </div>
    </div>
  </div>

  <!-- ==================== 时间线归档 ==================== -->
  {{ $pages := where site.RegularPages "Section" "in" (slice "posts" "studynotes" "portfolio") }}
  {{ $paginator := .Paginate $pages 20 }}
  
  <div class="timeline">
    {{ if $paginator.Pages }}
    {{ range ($paginator.Pages.GroupByDate "2006") }}
    <div class="year-section" style="margin-bottom: 2rem;">
      <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 0.5rem; font-size: 1.5rem;">
        <i class="fas fa-calendar-alt" style="margin-right: 0.5rem;"></i>
        {{ .Key }} 年
      </h2>
      <div class="post-list" style="margin-left: 1rem;">
        {{ range .Pages }}
        <div class="post-item" style="padding: 0.8rem 0; border-bottom: 1px solid #eee; position: relative;">
          <div style="display: flex; align-items: baseline;">
            <time datetime="{{ .Date.Format "2006-01-02" }}" style="color: #7f8c8d; min-width: 100px; display: inline-block;">
              {{ .Date.Format "01-02" }}
            </time>
            <a href="{{ .RelPermalink }}" style="color: #2c3e50; text-decoration: none; transition: color 0.3s; flex-grow: 1;">
              {{ .Title }}
              {{ if .Draft }}<span style="color: #e74c3c; font-size: 0.8em;">(草稿)</span>{{ end }}
            </a>
            <span style="color: #95a5a6; font-size: 0.9rem; margin-left: 1rem;">
              {{ .ReadingTime }}分钟阅读
            </span>
          </div>
          
          <!-- 分类标签组合显示 -->
          <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
            {{ with .Params.categories }}
            {{ range . }}
            {{ $categoryURL := printf "/categories/%s/" (. | urlize) }}
            <a href="{{ $categoryURL }}" style="
              background: #e8f4ff;
              padding: 0.2rem 0.6rem;
              border-radius: 12px;
              font-size: 0.8rem;
              color: #2c3e50;
              text-decoration: none;
              border: 1px solid #cfe2ff;
            ">
              <i class="fas fa-folder-open" style="margin-right: 0.3rem;"></i>{{ . }}
            </a>
            {{ end }}
            {{ end }}

            {{ with .Params.tags }}
            {{ range . }}
            {{ $tagURL := printf "/tags/%s/" (. | urlize) }}
            <a href="{{ $tagURL }}" style="
              background: #e2fbe8;
              padding: 0.2rem 0.6rem;
              border-radius: 12px;
              font-size: 0.8rem;
              color: #2c3e50;
              text-decoration: none;
              border: 1px solid #b8e6c5;
            ">
              <i class="fas fa-tag" style="margin-right: 0.3rem;"></i>{{ . }}
            </a>
            {{ end }}
            {{ end }}
          </div>
        </div>
        {{ end }}
      </div>
    </div>
    {{ end }}
    {{ else }}
    <div class="no-articles" style="text-align: center; padding: 2rem; color: #7f8c8d;">
      <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem;"></i>
      <p>暂时还没有归档内容哦~</p>
    </div>
    {{ end }}
  </div>

  <!-- ==================== 分页导航 ==================== -->
  {{ if gt $paginator.TotalPages 1 }}
  <div class="pagination" style="
    margin: 2rem 0;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
  ">
    {{ if $paginator.HasPrev }}
    <a href="{{ $paginator.Prev.URL }}" style="
      padding: 0.5rem 1rem;
      background: #3498db;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      transition: background 0.3s;
    ">
      ← 上一页
    </a>
    {{ end }}

    <div class="page-numbers" style="display: flex; gap: 0.3rem; align-items: center;">
      {{ $currentPage := $paginator.PageNumber }}
      {{ $totalPages := $paginator.TotalPages }}
      
      {{ if gt $currentPage 3 }}
      <a href="{{ $paginator.First.URL }}" style="padding: 0.5rem 0.8rem; border: 1px solid #ddd; border-radius: 4px; text-decoration: none; color: #2c3e50;">1</a>
      {{ if gt $currentPage 4 }}
      <span style="padding: 0.5rem;">...</span>
      {{ end }}
      {{ end }}

      {{ range $paginator.Pagers }}
      {{ if and (ge .PageNumber (sub $currentPage 2)) (le .PageNumber (add $currentPage 2)) }}
      {{ if eq .PageNumber $currentPage }}
      <span style="
        padding: 0.5rem 0.8rem;
        background: #3498db;
        color: white;
        border-radius: 4px;
        font-weight: bold;
      ">{{ .PageNumber }}</span>
      {{ else }}
      <a href="{{ .URL }}" style="
        padding: 0.5rem 0.8rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        text-decoration: none;
        color: #2c3e50;
        transition: all 0.3s;
      ">{{ .PageNumber }}</a>
      {{ end }}
      {{ end }}
      {{ end }}

      {{ if lt $currentPage (sub $totalPages 2) }}
      {{ if lt $currentPage (sub $totalPages 3) }}
      <span style="padding: 0.5rem;">...</span>
      {{ end }}
      <a href="{{ $paginator.Last.URL }}" style="padding: 0.5rem 0.8rem; border: 1px solid #ddd; border-radius: 4px; text-decoration: none; color: #2c3e50;">{{ $totalPages }}</a>
      {{ end }}
    </div>

    {{ if $paginator.HasNext }}
    <a href="{{ $paginator.Next.URL }}" style="
      padding: 0.5rem 1rem;
      background: #3498db;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      transition: background 0.3s;
    ">
      下一页 →
    </a>
    {{ end }}
  </div>

  <div style="text-align: center; color: #7f8c8d; font-size: 0.9rem; margin-top: 1rem;">
    第 {{ $paginator.PageNumber }} 页 / 共 {{ $paginator.TotalPages }} 页 | 共 {{ len $pages }} 篇文章
  </div>
  {{ end }}
</article>
{{ end }}